<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NUNF: Uncertainty Quantification Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">NUNF<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">Generalized neutron unfolding library for cpp</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('uncertainty_quantification_example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Uncertainty Quantification Example</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page walks you through an example of using uncertainty quantification. The code works by accepting a detector light output spectrum and smears the spectrum by a gaussian based on the sqrt mean value of each bin in the spectrum. It than does an iteration of the unfolding procedure in <a class="el" href="experimental_measurement_example.html">Experimental Measurement Section</a>. Finally it repeats a set amount of times and gives you the 1 sigma spread of each bin. Note the majority of code here is duplicate from <a class="el" href="experimental_measurement_example.html">Experimental Measurement Section</a> in which we will not explain. Instead we refer the reader to the aforementioned section when necessary.<br  />
If you'd like to run it right off the bat, without reading the explanation, please go to the bototm of the page.</p>
<h1>Code Walkthrough </h1>
<p>To begin please go to the root of the package if you are not already. Now open the file ./examples/Uncertainty_Example_Experimental_Measurement/Uncertainty_Example_Experimental_Measurement.C </p><pre class="fragment"> vim examples/Uncertainty_Example_Experimental_Measurement/Uncertainty_Example_Experimental_Measurement.C
</pre><p> We refer the reader to the comments. This page will walk the user through the code, making references to labeled code block numbers. While there may be multiple choices for a certain action such as reading in a file of multiple formats, we give one option may highlight another in the comments with an explanation. Some options may require a skim through the documentation.<br  />
<br  />
 </p><h2>Code block 1:</h2>
<pre class="fragment">    //Code Block 1: Code explained in Experimental_Measurement_Unfolding_Example in the Docuemntation. Please see that part of the documentation for more information._______________________
    UNFOLD::FILEIO *fio;
    fio = new UNFOLD::FILEIO();
    fio-&gt;setResponse("./Experimental_Measurement_Unfolding_Example/imports/response_matrices/EJ301D_D_and_P_TrackingTo55MeV0.1NEBins0.0025LOBins.txt",0,0,0,0.1,0.0025);
    float p0 = 572.0/1000.;
    float p1 = 2394.0/1000.;
    float p2 = 200.0/1000.;
    float fraction = 1.0;
    fio-&gt;conformBinning(p0,p1,p2,fraction);
    fio-&gt;setThresholdLO(0.16);
    fio-&gt;normalizeResponseToOne();
    fio-&gt;readInEfficiency("./Experimental_Measurement_Unfolding_Example/imports/EfficiencyTo55MeV.root","hist");
    fio-&gt;readInExpSpectrumRebin("./Experimental_Measurement_Unfolding_Example/imports/dt_only_neutrons_w_protons_hist_scaled_2pnt_07_07_2023.root","newHist");
    fio-&gt;setThreshold(0.5);
    UNFOLD::UNFOLD s(fio);
    std::cout &lt;&lt; "setting response matrix\n";
    s.setResponseMatrix();
    s.printParameters();
    s.setInSpectrum();

    s.calcNormMatrix();
    s.setInitialGuess(1.);

    // __START:___This portion of code can be commented out. Only used to see one iteration of unfolding.
    for(int i=0; i&lt;70; i++)
    {
      s.updateMLEM();
      s.updateStopIndices();

    }
    s.plotAnswer("Neutron Spectrum");
    s.exportAnswer("./Experimental_Measurement_Unfolding_Example/exports/answer_dt_only_neutrons_w_protons_hist_scaled_2pnt_07_07_2023.txt");

    s.plotProjection("lightOutput");
    s.exportForwardProjection("./Experimental_Measurement_Unfolding_Example/exports/projection.txt");
    //__END:___
</pre><p>This block of code, involves setup of the initial parameters. Since this is exact code from <a class="el" href="experimental_measurement_example.html">Experimental Measurement Section</a>, please see that section for a detailed explanation. We do note, that the last section labeled with the __START__... and __END__ is only to run a single iteration of unfolding if they'd like to test unfolding before. It may be commented out if the user does not want to do that.</p>
<h2>Code block 2:</h2>
<pre class="fragment">    //Line 1 and 2
    UNCERT::UNCERT *uncert;
    uncert=new UNCERT::UNCERT(&amp;s,3,UNCERT::UNCERT::UnfoldType::MLEM);

    //Line 3
    Eigen::MatrixXf reconstMtx= uncert-&gt;binGeneration();

    //Line 4 
    Eigen::MatrixXf simMtx= uncert-&gt;unfoldReconstructed(100);

    //Line 5 
    Eigen::VectorXf returned_vector =  uncert-&gt;plotSimulatedMeans("Neutron Energy Spectrum Statistics");
</pre><p>This block of code is the main part of the uncertainty quantification. We will walk through each line of code. <br  />
 In lines 1 and 2, we create a pointer to the class UNCERT. This class is the main class for uncertainty quantification. It takes in 3 arguments. The first is a pointer to the UNFOLD class. This pointer must be setup as if getting ready to unfold. This requires setting the necessary imports such as the response matrix, input spectrum, etc. using FILEIO and then passing it to an UNFOLD instance and calling the necessary functions such as calcNormMatrix(), setInSpectrum(), etc. The second is the number of iterations to run. The third is the type of unfolding to run. The type of unfolding is an enumeration that can be called using UNCERT::UNCERT::UnfoldType::MLEM, UNCERT::UNCERT::UnfoldType::GRAVEL, or UNCERT::UNCERT::UnfoldType::SIRT depending on the algorithm to be used.</p>
<p>Line 3 creates a Gaussian smeared light output distribution from the original for the amount of iterations specified in the constructor.</p>
<p>Line 4 uses each smeared Gaussian light output distribution and unfolds on them, putting each result into a vector and calculating both the mean and Std. Dev. of the net unfolding result</p>
<p>Line 5 is for visualization</p>
<h1><a class="anchor" id="running_the_program_2"></a>
Running the Program</h1>
<p>To run the example file that was described in this page, ./examples/Uncertainty_Example_Experimental_Measurement/Uncertainty_Example_Experimental_Measurement.C: <br  />
Please go to the root directory of the entire package<br  />
 From there change into the examples folder using </p><pre class="fragment">cd examples
</pre><p> Then run </p><pre class="fragment">bash kill_and_build.sh Uncertainty_Example_Experimental_Measurement/Uncertainty_Example_Experimental_Measurement.C
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Getting Started</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
